!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=107)}({107:function(e,t,n){e.exports=n(108)},108:function(e,t,n){(function(e){(function(t){"use strict";var r=void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=u(e);if(t){var i=u(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h(this,n)}}function f(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p=function(){var e=r.WebSocket;if(void 0===e)try{e=n(109)}catch(e){throw new Error('You must install the "ws" package to use Strophe in nodejs.')}return e}();var _=function(){var e=r.DOMParser;if(void 0===e)try{e=n(53).DOMParser}catch(e){throw new Error('You must install the "xmldom" package to use Strophe in nodejs.')}return e}();function g(){if("undefined"==typeof document)try{return(new(0,n(53).DOMImplementation)).createDocument("jabber:client","strophe",null)}catch(e){throw new Error('You must install the "xmldom" package to use Strophe in nodejs.')}if(void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10){var e=function(){for(var e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(e){}}();return e.appendChild(e.createElement("strophe")),e}return document.implementation.createDocument("jabber:client","strophe",null)}var v=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},y=function(e){if("string"!=typeof e)throw new Error("str2binl was passed a non-string");for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},b=function(e,t,n,r,i,o){return v((s=v(v(t,e),v(r,o)))<<(a=i)|s>>>32-a,n);var s,a},N=function(e,t,n,r,i,o,s){return b(t&n|~t&r,e,t,i,o,s)},S=function(e,t,n,r,i,o,s){return b(t&r|n&~r,e,t,i,o,s)},w=function(e,t,n,r,i,o,s){return b(t^n^r,e,t,i,o,s)},T=function(e,t,n,r,i,o,s){return b(n^(t|~r),e,t,i,o,s)},x=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n,r,i,o,s=1732584193,a=-271733879,c=-1732584194,u=271733878,l=0;l<e.length;l+=16)n=s,r=a,i=c,o=u,s=N(s,a,c,u,e[l+0],7,-680876936),u=N(u,s,a,c,e[l+1],12,-389564586),c=N(c,u,s,a,e[l+2],17,606105819),a=N(a,c,u,s,e[l+3],22,-1044525330),s=N(s,a,c,u,e[l+4],7,-176418897),u=N(u,s,a,c,e[l+5],12,1200080426),c=N(c,u,s,a,e[l+6],17,-1473231341),a=N(a,c,u,s,e[l+7],22,-45705983),s=N(s,a,c,u,e[l+8],7,1770035416),u=N(u,s,a,c,e[l+9],12,-1958414417),c=N(c,u,s,a,e[l+10],17,-42063),a=N(a,c,u,s,e[l+11],22,-1990404162),s=N(s,a,c,u,e[l+12],7,1804603682),u=N(u,s,a,c,e[l+13],12,-40341101),c=N(c,u,s,a,e[l+14],17,-1502002290),a=N(a,c,u,s,e[l+15],22,1236535329),s=S(s,a,c,u,e[l+1],5,-165796510),u=S(u,s,a,c,e[l+6],9,-1069501632),c=S(c,u,s,a,e[l+11],14,643717713),a=S(a,c,u,s,e[l+0],20,-373897302),s=S(s,a,c,u,e[l+5],5,-701558691),u=S(u,s,a,c,e[l+10],9,38016083),c=S(c,u,s,a,e[l+15],14,-660478335),a=S(a,c,u,s,e[l+4],20,-405537848),s=S(s,a,c,u,e[l+9],5,568446438),u=S(u,s,a,c,e[l+14],9,-1019803690),c=S(c,u,s,a,e[l+3],14,-187363961),a=S(a,c,u,s,e[l+8],20,1163531501),s=S(s,a,c,u,e[l+13],5,-1444681467),u=S(u,s,a,c,e[l+2],9,-51403784),c=S(c,u,s,a,e[l+7],14,1735328473),a=S(a,c,u,s,e[l+12],20,-1926607734),s=w(s,a,c,u,e[l+5],4,-378558),u=w(u,s,a,c,e[l+8],11,-2022574463),c=w(c,u,s,a,e[l+11],16,1839030562),a=w(a,c,u,s,e[l+14],23,-35309556),s=w(s,a,c,u,e[l+1],4,-1530992060),u=w(u,s,a,c,e[l+4],11,1272893353),c=w(c,u,s,a,e[l+7],16,-155497632),a=w(a,c,u,s,e[l+10],23,-1094730640),s=w(s,a,c,u,e[l+13],4,681279174),u=w(u,s,a,c,e[l+0],11,-358537222),c=w(c,u,s,a,e[l+3],16,-722521979),a=w(a,c,u,s,e[l+6],23,76029189),s=w(s,a,c,u,e[l+9],4,-640364487),u=w(u,s,a,c,e[l+12],11,-421815835),c=w(c,u,s,a,e[l+15],16,530742520),a=w(a,c,u,s,e[l+2],23,-995338651),s=T(s,a,c,u,e[l+0],6,-198630844),u=T(u,s,a,c,e[l+7],10,1126891415),c=T(c,u,s,a,e[l+14],15,-1416354905),a=T(a,c,u,s,e[l+5],21,-57434055),s=T(s,a,c,u,e[l+12],6,1700485571),u=T(u,s,a,c,e[l+3],10,-1894986606),c=T(c,u,s,a,e[l+10],15,-1051523),a=T(a,c,u,s,e[l+1],21,-2054922799),s=T(s,a,c,u,e[l+8],6,1873313359),u=T(u,s,a,c,e[l+15],10,-30611744),c=T(c,u,s,a,e[l+6],15,-1560198380),a=T(a,c,u,s,e[l+13],21,1309151649),s=T(s,a,c,u,e[l+4],6,-145523070),u=T(u,s,a,c,e[l+11],10,-1120210379),c=T(c,u,s,a,e[l+2],15,718787259),a=T(a,c,u,s,e[l+9],21,-343485551),s=v(s,n),a=v(a,r),c=v(c,i),u=v(u,o);return[s,a,c,u]},C={hexdigest:function(e){return function(e){for(var t="",n=0;n<4*e.length;n++)t+="0123456789abcdef".charAt(e[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(e[n>>2]>>n%4*8&15);return t}(x(y(e),8*e.length))},hash:function(e){return function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(x(y(e),8*e.length))}};function E(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;var n,r,i,o,s,a,c,u,l=new Array(80),h=1732584193,d=-271733879,f=-1732584194,m=271733878,p=-1009589776;for(n=0;n<e.length;n+=16){for(o=h,s=d,a=f,c=m,u=p,r=0;r<80;r++)l[r]=r<16?e[n+r]:O(l[r-3]^l[r-8]^l[r-14]^l[r-16],1),i=I(I(O(h,5),A(r,d,f,m)),I(I(p,l[r]),k(r))),p=m,m=f,f=O(d,30),d=h,h=i;h=I(h,o),d=I(d,s),f=I(f,a),m=I(m,c),p=I(p,u)}return[h,d,f,m,p]}function A(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function k(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function D(e,t){var n=R(e);n.length>16&&(n=E(n,8*e.length));for(var r=new Array(16),i=new Array(16),o=0;o<16;o++)r[o]=909522486^n[o],i[o]=1549556828^n[o];var s=E(r.concat(R(t)),512+8*t.length);return E(i.concat(s),672)}function I(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function O(e,t){return e<<t|e>>>32-t}function R(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function M(e){for(var t,n,r="",i=0;i<4*e.length;i+=3)for(t=(e[i>>2]>>8*(3-i%4)&255)<<16|(e[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|e[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;n<4;n++)8*i+6*n>32*e.length?r+="=":r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-n)&63);return r}function L(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}var H={b64_hmac_sha1:function(e,t){return M(D(e,t))},b64_sha1:function(e){return M(E(R(e),8*e.length))},binb2str:L,core_hmac_sha1:D,str_hmac_sha1:function(e,t){return L(D(e,t))},str_sha1:function(e){return L(E(R(e),8*e.length))}},q={utf16to8:function(e){var t,n,r="",i=e.length;for(t=0;t<i;t++)(n=e.charCodeAt(t))>=0&&n<=127?r+=e.charAt(t):n>2047?(r+=String.fromCharCode(224|n>>12&15),r+=String.fromCharCode(128|n>>6&63),r+=String.fromCharCode(128|n>>0&63)):(r+=String.fromCharCode(192|n>>6&31),r+=String.fromCharCode(128|n>>0&63));return r},addCookies:function(e){for(var t in e=e||{})if(Object.prototype.hasOwnProperty.call(e,t)){var n="",r="",o="",s=e[t],a="object"===i(s),c=escape(unescape(a?s.value:s));a&&(n=s.expires?";expires="+s.expires:"",r=s.domain?";domain="+s.domain:"",o=s.path?";path="+s.path:""),document.cookie=t+"="+c+n+r+o}}};var F={atob:function(e){if((e=(e="".concat(e)).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;for(var t="",n=0,r=0,i=0;i<e.length;i++)n<<=6,n|=(o=e[i],/[A-Z]/.test(o)?o.charCodeAt(0)-"A".charCodeAt(0):/[a-z]/.test(o)?o.charCodeAt(0)-"a".charCodeAt(0)+26:/[0-9]/.test(o)?o.charCodeAt(0)-"0".charCodeAt(0)+52:"+"===o?62:"/"===o?63:void 0),24===(r+=6)&&(t+=String.fromCharCode((16711680&n)>>16),t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n),n=r=0);var o;return 12===r?(n>>=4,t+=String.fromCharCode(n)):18===r&&(n>>=2,t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n)),t},btoa:function(e){var t;for(e="".concat(e),t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return null;var n="";for(t=0;t<e.length;t+=3){var r=[void 0,void 0,void 0,void 0];r[0]=e.charCodeAt(t)>>2,r[1]=(3&e.charCodeAt(t))<<4,e.length>t+1&&(r[1]|=e.charCodeAt(t+1)>>4,r[2]=(15&e.charCodeAt(t+1))<<2),e.length>t+2&&(r[2]|=e.charCodeAt(t+2)>>6,r[3]=63&e.charCodeAt(t+2));for(var i=0;i<r.length;i++)void 0===r[i]?n+="=":n+=(o=r[i])<26?String.fromCharCode(o+"A".charCodeAt(0)):o<52?String.fromCharCode(o-26+"a".charCodeAt(0)):o<62?String.fromCharCode(o-52+"0".charCodeAt(0)):62===o?"+":63===o?"/":void 0}var o;return n}};function B(e,t){return new X.Builder(e,t)}function j(e){return new X.Builder("message",e)}function U(e){return new X.Builder("iq",e)}function P(e){return new X.Builder("presence",e)}var X={VERSION:"1.4.1",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<X.XHTML.tags.length;t++)if(e===X.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if(void 0!==X.XHTML.attributes[e]&&X.XHTML.attributes[e].length>0)for(var n=0;n<X.XHTML.attributes[e].length;n++)if(t===X.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<X.XHTML.css.length;t++)if(e===X.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11,ATTACHFAIL:12},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){X.NS[e]=t},forEachChild:function(e,t,n){for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];i.nodeType!==X.ElementType.NORMAL||t&&!this.isTagEqual(i,t)||n(i)}},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,xmlGenerator:function(){return X._xmlGenerator||(X._xmlGenerator=g()),X._xmlGenerator},xmlElement:function(e){if(!e)return null;for(var t=X.xmlGenerator().createElement(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r)if("string"==typeof r||"number"==typeof r)t.appendChild(X.xmlTextNode(r));else if("object"===i(r)&&"function"==typeof r.sort)for(var o=0;o<r.length;o++){var s=r[o];"object"===i(s)&&"function"==typeof s.sort&&void 0!==s[1]&&null!==s[1]&&t.setAttribute(s[0],s[1])}else if("object"===i(r))for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&void 0!==r[a]&&null!==r[a]&&t.setAttribute(a,r[a])}return t},xmlescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(e){return X.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;_?t=(new _).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e));return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===X.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===X.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return X.xmlescape(t)},copyElement:function(e){var t;if(e.nodeType===X.ElementType.NORMAL){t=X.xmlElement(e.tagName);for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(var r=0;r<e.childNodes.length;r++)t.appendChild(X.copyElement(e.childNodes[r]))}else e.nodeType===X.ElementType.TEXT&&(t=X.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml:function(e){var t;if(e.nodeType===X.ElementType.NORMAL){var n=e.nodeName.toLowerCase();if(X.XHTML.validTag(n))try{t=X.xmlElement(n);for(var r=0;r<X.XHTML.attributes[n].length;r++){var o=X.XHTML.attributes[n][r],s=e.getAttribute(o);if(void 0!==s&&null!==s&&""!==s&&!1!==s&&0!==s)if("style"===o&&"object"===i(s)&&void 0!==s.cssText&&(s=s.cssText),"style"===o){for(var a=[],c=s.split(";"),u=0;u<c.length;u++){var l=c[u].split(":"),h=l[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(X.XHTML.validCSS(h)){var d=l[1].replace(/^\s*/,"").replace(/\s*$/,"");a.push(h+": "+d)}}a.length>0&&(s=a.join("; "),t.setAttribute(o,s))}else t.setAttribute(o,s)}for(var f=0;f<e.childNodes.length;f++)t.appendChild(X.createHtml(e.childNodes[f]))}catch(e){t=X.xmlTextNode("")}else{t=X.xmlGenerator().createDocumentFragment();for(var m=0;m<e.childNodes.length;m++)t.appendChild(X.createHtml(e.childNodes[m]))}}else if(e.nodeType===X.ElementType.FRAGMENT){t=X.xmlGenerator().createDocumentFragment();for(var p=0;p<e.childNodes.length;p++)t.appendChild(X.createHtml(e.childNodes[p]))}else e.nodeType===X.ElementType.TEXT&&(t=X.xmlTextNode(e.nodeValue));return t},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=X.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){if(!e)return null;var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&X.fatal(e.stack),e.sourceURL?X.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?X.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):X.fatal("error: "+e.message)},log:function(e,t){var n;e===this.LogLevel.FATAL&&(null===(n=console)||void 0===n||n.error(t))},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var t=f(Array(e.attributes.length).keys()).map(function(t){return e.attributes[t].nodeName});t.sort();var n=t.reduce(function(t,n){return"".concat(t," ").concat(n,'="').concat(X.xmlescape(e.attributes.getNamedItem(n).value),'"')},"<".concat(e.nodeName));if(e.childNodes.length>0){n+=">";for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];switch(i.nodeType){case X.ElementType.NORMAL:n+=X.serialize(i);break;case X.ElementType.TEXT:n+=X.xmlescape(i.nodeValue);break;case X.ElementType.CDATA:n+="<![CDATA["+i.nodeValue+"]]>"}}n+="</"+e.nodeName+">"}else n+="/>";return n},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){X._connectionPlugins[e]=t}};X.Builder=function(){function e(t,n){o(this,e),"presence"!==t&&"message"!==t&&"iq"!==t||(n&&!n.xmlns?n.xmlns=X.NS.CLIENT:n||(n={xmlns:X.NS.CLIENT})),this.nodeTree=X.xmlElement(t,n),this.node=this.nodeTree}return a(e,[{key:"tree",value:function(){return this.nodeTree}},{key:"toString",value:function(){return X.serialize(this.nodeTree)}},{key:"up",value:function(){return this.node=this.node.parentNode,this}},{key:"root",value:function(){return this.node=this.nodeTree,this}},{key:"attrs",value:function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this}},{key:"c",value:function(e,t,n){var r=X.xmlElement(e,t,n);return this.node.appendChild(r),"string"!=typeof n&&"number"!=typeof n&&(this.node=r),this}},{key:"cnode",value:function(e){var t,n=X.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}var r=t?n.importNode(e,!0):X.copyElement(e);return this.node.appendChild(r),this.node=r,this}},{key:"t",value:function(e){var t=X.xmlTextNode(e);return this.node.appendChild(t),this}},{key:"h",value:function(e){var t=X.xmlGenerator().createElement("body");t.innerHTML=e;for(var n=X.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}}]),e}(),X.Handler=function(e,t,n,r,i,o,s){this.handler=e,this.ns=t,this.name=n,this.type=r,this.id=i,this.options=s||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(X.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=o?X.getBareJidFromJid(o):null:this.from=o,this.user=!0},X.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=this,n=!1;return!this.ns||(X.forEachChild(e,null,function(e){t.getNamespace(e)===t.ns&&(n=!0)}),n||this.getNamespace(e)===this.ns)},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=X.getBareJidFromJid(t));var n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!X.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(e){throw X._handleError(e),e}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},X.TimedHandler=function(){function e(t,n){o(this,e),this.period=t,this.handler=n,this.lastCalled=(new Date).getTime(),this.user=!0}return a(e,[{key:"run",value:function(){return this.lastCalled=(new Date).getTime(),this.handler()}},{key:"reset",value:function(){this.lastCalled=(new Date).getTime()}},{key:"toString",value:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}}]),e}(),X.Connection=function(){function e(t,n){var r=this;for(var i in o(this,e),this.service=t,this.options=n||{},this.setProtocol(),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_bind=!1,this.do_session=!1,this.mechanisms={},this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){return r._onIdle()},100),q.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),X._connectionPlugins)if(Object.prototype.hasOwnProperty.call(X._connectionPlugins,i)){var s=function(){};s.prototype=X._connectionPlugins[i],this[i]=new s,this[i].init(this)}}return a(e,[{key:"setProtocol",value:function(){var e=this.options.protocol||"";this.options.worker?this._proto=new X.WorkerWebsocket(this):0===this.service.indexOf("ws:")||0===this.service.indexOf("wss:")||0===e.indexOf("ws")?this._proto=new X.Websocket(this):this._proto=new X.Bosh(this)}},{key:"reset",value:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0}},{key:"pause",value:function(){this.paused=!0}},{key:"resume",value:function(){this.paused=!1}},{key:"getUniqueId",value:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""}},{key:"addProtocolErrorHandler",value:function(e,t,n){this.protocolErrorHandlers[e][t]=n}},{key:"connect",value:function(e,t,n,r,i,o,s){this.jid=e,this.authzid=X.getBareJidFromJid(this.jid),this.authcid=s||X.getNodeFromJid(this.jid),this.pass=t,this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=X.getDomainFromJid(this.jid),this._changeConnectStatus(X.Status.CONNECTING,null),this._proto._connect(r,i,o)}},{key:"attach",value:function(e,t,n,r,i,o,s){if(this._proto._attach)return this._proto._attach(e,t,n,r,i,o,s);var a=new Error('The "attach" method is not available for your connection protocol');throw a.name="StropheSessionError",a}},{key:"restore",value:function(e,t,n,r,i){if(!this._sessionCachingSupported()){var o=new Error('The "restore" method can only be used with a BOSH connection.');throw o.name="StropheSessionError",o}this._proto._restore(e,t,n,r,i)}},{key:"_sessionCachingSupported",value:function(){if(this._proto instanceof X.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1}},{key:"xmlInput",value:function(e){}},{key:"xmlOutput",value:function(e){}},{key:"rawInput",value:function(e){}},{key:"rawOutput",value:function(e){}},{key:"nextValidRid",value:function(e){}},{key:"send",value:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}}},{key:"flush",value:function(){clearTimeout(this._idleTimeout),this._onIdle()}},{key:"sendPresence",value:function(e,t,n,r){var i=this,o=null;"function"==typeof e.tree&&(e=e.tree());var s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendPresence"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){var a=this.addHandler(function(e){o&&i.deleteTimedHandler(o),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)},null,"presence",null,s);r&&(o=this.addTimedHandler(r,function(){return i.deleteHandler(a),n&&n(null),!1}))}return this.send(e),s}},{key:"sendIQ",value:function(e,t,n,r){var i=this,o=null;"function"==typeof e.tree&&(e=e.tree());var s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendIQ"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){var a=this.addHandler(function(e){o&&i.deleteTimedHandler(o);var r=e.getAttribute("type");if("result"===r)t&&t(e);else{if("error"!==r){var s=new Error("Got bad IQ type of ".concat(r));throw s.name="StropheError",s}n&&n(e)}},null,"iq",["error","result"],s);r&&(o=this.addTimedHandler(r,function(){return i.deleteHandler(a),n&&n(null),!1}))}return this.send(e),s}},{key:"_queueData",value:function(e){if(null===e||!e.tagName||!e.childNodes){var t=new Error("Cannot queue non-DOMElement.");throw t.name="StropheError",t}this._data.push(e)}},{key:"_sendRestart",value:function(){var e=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){return e._onIdle()},100)}},{key:"addTimedHandler",value:function(e,t){var n=new X.TimedHandler(e,t);return this.addTimeds.push(n),n}},{key:"deleteTimedHandler",value:function(e){this.removeTimeds.push(e)}},{key:"addHandler",value:function(e,t,n,r,i,o,s){var a=new X.Handler(e,t,n,r,i,o,s);return this.addHandlers.push(a),a}},{key:"deleteHandler",value:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)}},{key:"registerSASLMechanisms",value:function(e){var t=this;this.mechanisms={},(e=e||[X.SASLAnonymous,X.SASLExternal,X.SASLOAuthBearer,X.SASLXOAuth2,X.SASLPlain,X.SASLSHA1]).forEach(function(e){return t.registerSASLMechanism(e)})}},{key:"registerSASLMechanism",value:function(e){var t=new e;this.mechanisms[t.mechname]=t}},{key:"disconnect",value:function(e){if(this._changeConnectStatus(X.Status.DISCONNECTING,e),e?X.warn("Disconnect was called because: "+e):X.info("Disconnect was called"),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=P({xmlns:X.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else X.warn("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()}},{key:"_changeConnectStatus",value:function(e,t,n){for(var r in X._connectionPlugins)if(Object.prototype.hasOwnProperty.call(X._connectionPlugins,r)){var i=this[r];if(i.statusChanged)try{i.statusChanged(e,t)}catch(e){X.error("".concat(r," plugin caused an exception changing status: ").concat(e))}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){X._handleError(e),X.error("User connection callback caused an exception: ".concat(e))}}},{key:"_doDisconnect",value:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),X.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(X.Status.DISCONNECTED,e),this.connected=!1}},{key:"_dataRecv",value:function(e,t){var n=this,r=this._proto._reqToData(e);if(null!==r){for(this.xmlInput!==X.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==X.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(X.serialize(r)));this.removeHandlers.length>0;){var i=this.removeHandlers.pop(),o=this.handlers.indexOf(i);o>=0&&this.handlers.splice(o,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var s=r.getAttribute("type");if(null!==s&&"terminate"===s){if(this.disconnecting)return;var a=r.getAttribute("condition"),c=r.getElementsByTagName("conflict");return null!==a?("remote-stream-error"===a&&c.length>0&&(a="conflict"),this._changeConnectStatus(X.Status.CONNFAIL,a)):this._changeConnectStatus(X.Status.CONNFAIL,X.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(a)}X.forEachChild(r,null,function(e){var t=n.handlers;n.handlers=[];for(var r=0;r<t.length;r++){var i=t[r];try{!i.isMatch(e)||!n.authenticated&&i.user?n.handlers.push(i):i.run(e)&&n.handlers.push(i)}catch(e){X.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}}}},{key:"_connect_cb",value:function(e,t,n){var r,i=this;X.debug("_connect_cb was called"),this.connected=!0;try{r=this._proto._reqToData(e)}catch(e){if(e.name!==X.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(X.Status.CONNFAIL,X.ErrorCondition.BAD_FORMAT),this._doDisconnect(X.ErrorCondition.BAD_FORMAT)}if(r&&(this.xmlInput!==X.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==X.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(X.serialize(r))),this._proto._connect_cb(r)!==X.Status.CONNFAIL))if(r.getElementsByTagNameNS?r.getElementsByTagNameNS(X.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0){var o=Array.from(r.getElementsByTagName("mechanism")).map(function(e){return i.mechanisms[e.textContent]}).filter(function(e){return e});0!==o.length||0!==r.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(o):this._proto._no_auth_received(t)}else this._proto._no_auth_received(t)}},{key:"sortMechanismsByPriority",value:function(e){for(var t=0;t<e.length-1;++t){for(var n=t,r=t+1;r<e.length;++r)e[r].priority>e[n].priority&&(n=r);if(n!==t){var i=e[t];e[t]=e[n],e[n]=i}}return e}},{key:"authenticate",value:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()}},{key:"_attemptSASLAuth",value:function(e){e=this.sortMechanismsByPriority(e||[]);for(var t=!1,n=0;n<e.length;++n)if(e[n].test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=e[n],this._sasl_mechanism.onStart(this);var r=B("auth",{xmlns:X.NS.SASL,mechanism:this._sasl_mechanism.mechname});if(this._sasl_mechanism.isClientFirst){var i=this._sasl_mechanism.onChallenge(this,null);r.t(F.btoa(i))}this.send(r.tree()),t=!0;break}return t}},{key:"_sasl_challenge_cb",value:function(e){var t=F.atob(X.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),r=B("response",{xmlns:X.NS.SASL});return""!==n&&r.t(F.btoa(n)),this.send(r.tree()),!0}},{key:"_attemptLegacyAuth",value:function(){null===X.getNodeFromJid(this.jid)?(this._changeConnectStatus(X.Status.CONNFAIL,X.ErrorCondition.MISSING_JID_NODE),this.disconnect(X.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(X.Status.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(U({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:X.NS.AUTH}).c("username",{}).t(X.getNodeFromJid(this.jid)).tree()))}},{key:"_onLegacyAuthIQResult",value:function(e){var t=U({type:"set",id:"_auth_2"}).c("query",{xmlns:X.NS.AUTH}).c("username",{}).t(X.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return X.getResourceFromJid(this.jid)||(this.jid=X.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(X.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1}},{key:"_sasl_success_cb",value:function(e){var t=this;if(this._sasl_data["server-signature"]){var n,r=F.atob(X.getText(e)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===r[1]&&(n=r[2]),n!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}X.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var i=[],o=function(e,n){for(;e.length;)t.deleteHandler(e.pop());return t._onStreamFeaturesAfterSASL(n),!1};return i.push(this._addSysHandler(function(e){return o(i,e)},null,"stream:features",null,null)),i.push(this._addSysHandler(function(e){return o(i,e)},X.NS.STREAM,"features",null,null)),this._sendRestart(),!1}},{key:"_onStreamFeaturesAfterSASL",value:function(e){this.features=e;for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(X.Status.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(X.Status.AUTHFAIL,null),!1)}},{key:"bind",value:function(){if(this.do_bind){this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");var e=X.getResourceFromJid(this.jid);e?this.send(U({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:X.NS.BIND}).c("resource",{}).t(e).tree()):this.send(U({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:X.NS.BIND}).tree())}else X.log(X.LogLevel.INFO,'Strophe.Connection.prototype.bind called but "do_bind" is false')}},{key:"_onResourceBindResultIQ",value:function(e){var t;if("error"===e.getAttribute("type"))return X.warn("Resource binding failed."),e.getElementsByTagName("conflict").length>0&&(t=X.ErrorCondition.CONFLICT),this._changeConnectStatus(X.Status.AUTHFAIL,t,e),!1;var n=e.getElementsByTagName("bind");if(!(n.length>0))return X.warn("Resource binding failed."),this._changeConnectStatus(X.Status.AUTHFAIL,null,e),!1;var r=n[0].getElementsByTagName("jid");r.length>0&&(this.authenticated=!0,this.jid=X.getText(r[0]),this.do_session?this._establishSession():this._changeConnectStatus(X.Status.CONNECTED,null))}},{key:"_establishSession",value:function(){if(!this.do_session)throw new Error("Strophe.Connection.prototype._establishSession "+"called but apparently ".concat(X.NS.SESSION," wasn't advertised by the server"));this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(U({type:"set",id:"_session_auth_2"}).c("session",{xmlns:X.NS.SESSION}).tree())}},{key:"_onSessionResultIQ",value:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(X.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return this.authenticated=!1,X.warn("Session creation failed."),this._changeConnectStatus(X.Status.AUTHFAIL,null,e),!1;return!1}},{key:"_sasl_failure_cb",value:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(X.Status.AUTHFAIL,null,e),!1}},{key:"_auth2_cb",value:function(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(X.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(X.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1}},{key:"_addSysTimedHandler",value:function(e,t){var n=new X.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n}},{key:"_addSysHandler",value:function(e,t,n,r,i){var o=new X.Handler(e,t,n,r,i);return o.user=!1,this.addHandlers.push(o),o}},{key:"_onDisconnectTimeout",value:function(){return X.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(X.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1}},{key:"_onIdle",value:function(){for(var e=this;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){var t=this.removeTimeds.pop(),n=this.timedHandlers.indexOf(t);n>=0&&this.timedHandlers.splice(n,1)}for(var r=(new Date).getTime(),i=[],o=0;o<this.timedHandlers.length;o++){var s=this.timedHandlers[o];if(this.authenticated||!s.user)s.lastCalled+s.period-r<=0?s.run()&&i.push(s):i.push(s)}this.timedHandlers=i,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){return e._onIdle()},100))}}]),e}(),X.SASLMechanism=function(){function e(t,n,r){o(this,e),this.mechname=t,this.isClientFirst=n,this.priority=r}return a(e,[{key:"test",value:function(){return!0}},{key:"onStart",value:function(e){this._connection=e}},{key:"onChallenge",value:function(e,t){throw new Error("You should implement challenge handling!")}},{key:"onFailure",value:function(){this._connection=null}},{key:"onSuccess",value:function(){this._connection=null}}]),e}(),X.SASLAnonymous=function(e){c(n,X.SASLMechanism);var t=d(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ANONYMOUS",r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;return o(this,n),t.call(this,e,r,i)}return a(n,[{key:"test",value:function(e){return null===e.authcid}}]),n}(),X.SASLPlain=function(e){c(n,X.SASLMechanism);var t=d(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PLAIN",r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;return o(this,n),t.call(this,e,r,i)}return a(n,[{key:"test",value:function(e){return null!==e.authcid}},{key:"onChallenge",value:function(e){var t=e.authcid,n=e.authzid,r=e.domain,i=e.pass;if(!r)throw new Error("SASLPlain onChallenge: domain is not defined!");var o=n!=="".concat(t,"@").concat(r)?n:"";return o+="\0",o+=t,o+="\0",o+=i,q.utf16to8(o)}}]),n}(),X.SASLSHA1=function(e){c(n,X.SASLMechanism);var t=d(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-1",r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;return o(this,n),t.call(this,e,r,i)}return a(n,[{key:"test",value:function(e){return null!==e.authcid}},{key:"onChallenge",value:function(e,t,n){var r=n||C.hexdigest(""+1234567890*Math.random()),i="n="+q.utf16to8(e.authcid);return i+=",r=",i+=r,e._sasl_data.cnonce=r,e._sasl_data["client-first-message-bare"]=i,i="n,,"+i,this.onChallenge=function(e,t){for(var n,r,i,o,s,a,c,u,l="c=biws,",h="".concat(e._sasl_data["client-first-message-bare"],",").concat(t,","),d=e._sasl_data.cnonce,f=/([a-z]+)=([^,]+)(,|$)/;t.match(f);){var m=t.match(f);switch(t=t.replace(m[0],""),m[1]){case"r":n=m[2];break;case"s":r=m[2];break;case"i":i=m[2]}}if(n.substr(0,d.length)!==d)return e._sasl_data={},e._sasl_failure_cb();h+=l+="r="+n,r=F.atob(r),r+="\0\0\0";var p=q.utf16to8(e.pass);for(o=a=H.core_hmac_sha1(p,r),c=1;c<i;c++){for(s=H.core_hmac_sha1(p,H.binb2str(a)),u=0;u<5;u++)o[u]^=s[u];a=s}o=H.binb2str(o);var _=H.core_hmac_sha1(o,"Client Key"),g=H.str_hmac_sha1(o,"Server Key"),v=H.core_hmac_sha1(H.str_sha1(H.binb2str(_)),h);for(e._sasl_data["server-signature"]=H.b64_hmac_sha1(g,h),u=0;u<5;u++)_[u]^=v[u];return l+=",p="+F.btoa(H.binb2str(_))},i}}]),n}(),X.SASLOAuthBearer=function(e){c(n,X.SASLMechanism);var t=d(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"OAUTHBEARER",r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:40;return o(this,n),t.call(this,e,r,i)}return a(n,[{key:"test",value:function(e){return null!==e.pass}},{key:"onChallenge",value:function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",q.utf16to8(t)}}]),n}(),X.SASLExternal=function(e){c(n,X.SASLMechanism);var t=d(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"EXTERNAL",r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return o(this,n),t.call(this,e,r,i)}return a(n,[{key:"onChallenge",value:function(e){return e.authcid===e.authzid?"":e.authzid}}]),n}(),X.SASLXOAuth2=function(e){c(n,X.SASLMechanism);var t=d(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"X-OAUTH2",r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30;return o(this,n),t.call(this,e,r,i)}return a(n,[{key:"test",value:function(e){return null!==e.pass}},{key:"onChallenge",value:function(e){var t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,q.utf16to8(t)}}]),n}();var $={Strophe:X,$build:B,$iq:U,$msg:j,$pres:P,SHA1:H,MD5:C,b64_hmac_sha1:H.b64_hmac_sha1,b64_sha1:H.b64_sha1,str_hmac_sha1:H.str_hmac_sha1,str_sha1:H.str_sha1};X.Request=function(){function e(t,n,r,i){o(this,e),this.id=++X._requestId,this.xmlData=t,this.data=X.serialize(t),this.origFunc=n,this.func=n,this.rid=r,this.date=NaN,this.sends=i||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()}return a(e,[{key:"getResponse",value:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(e=this.xhr.responseXML.documentElement).tagName)throw X.error("invalid response received"),X.error("responseText: "+this.xhr.responseText),X.error("responseXML: "+X.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(X.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(e=(new _).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(e.querySelector("parsererror")){X.error("invalid response received: "+e.querySelector("parsererror").textContent),X.error("responseText: "+this.xhr.responseText);var t=new Error;throw t.name=X.ErrorCondition.BAD_FORMAT,t}}return e}},{key:"_newXHR",value:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}}]),e}(),X.Bosh=function(){function e(t){o(this,e),this._conn=t,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]}return a(e,[{key:"_buildBody",value:function(){var e=B("body",{rid:this.rid++,xmlns:X.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e}},{key:"_reset",value:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}},{key:"_connect",value:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;var r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":X.NS.BOSH});n&&r.attrs({route:n});var i=this._conn._connect_cb;this._requests.push(new X.Request(r.tree(),this._onRequestStateChange.bind(this,i.bind(this._conn)),r.tree().getAttribute("rid"))),this._throttledRequestHandler()}},{key:"_attach",value:function(e,t,n,r,i,o,s){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=r,this._conn.domain=X.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=i||this.wait,this.hold=o||this.hold,this.window=s||this.window,this._conn._changeConnectStatus(X.Status.ATTACHED,null)}},{key:"_restore",value:function(e,t,n,r,i){var o=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(void 0!==o&&null!==o&&o.rid&&o.sid&&o.jid&&(void 0===e||null===e||X.getBareJidFromJid(o.jid)===X.getBareJidFromJid(e)||null===X.getNodeFromJid(e)&&X.getDomainFromJid(o.jid)===e))){var s=new Error("_restore: no restoreable session.");throw s.name="StropheSessionError",s}this._conn.restored=!0,this._attach(o.jid,o.sid,o.rid,t,n,r,i)}},{key:"_cacheSession",value:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")}},{key:"_connect_cb",value:function(e){var t=e.getAttribute("type");if(null!==t&&"terminate"===t){var n=e.getAttribute("condition");X.error("BOSH-Connection failed: "+n);var r=e.getElementsByTagName("conflict");return null!==n?("remote-stream-error"===n&&r.length>0&&(n="conflict"),this._conn._changeConnectStatus(X.Status.CONNFAIL,n)):this._conn._changeConnectStatus(X.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),X.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));var i=e.getAttribute("requests");i&&(this.window=parseInt(i,10));var o=e.getAttribute("hold");o&&(this.hold=parseInt(o,10));var s=e.getAttribute("wait");s&&(this.wait=parseInt(s,10));var a=e.getAttribute("inactivity");a&&(this.inactivity=parseInt(a,10))}},{key:"_disconnect",value:function(e){this._sendTerminate(e)}},{key:"_doDisconnect",value:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}},{key:"_emptyQueue",value:function(){return 0===this._requests.length}},{key:"_callProtocolErrorHandlers",value:function(t){var n=e._getRequestStatus(t),r=this._conn.protocolErrorHandlers.HTTP[n];r&&r.call(this,n)}},{key:"_hitError",value:function(e){this.errors++,X.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()}},{key:"_no_auth_received",value:function(e){X.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new X.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}},{key:"_onDisconnectTimeout",value:function(){this._abortAllRequests()}},{key:"_abortAllRequests",value:function(){for(;this._requests.length>0;){var e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}}},{key:"_onIdle",value:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(X.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":X.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new X.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var r=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(X.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),r>Math.floor(X.TIMEOUT*this.wait)&&(X.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(X.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}}},{key:"_onRequestStateChange",value:function(t,n){if(X.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)n.abort=!1;else if(4===n.xhr.readyState){var r=e._getRequestStatus(n);if(this.lastResponseHeaders=n.xhr.getAllResponseHeaders(),this._conn.disconnecting&&r>=400)return this._hitError(r),void this._callProtocolErrorHandlers(n);var i=r>0&&r<500,o=n.sends>this._conn.maxRetries;if((i||o)&&(this._removeRequest(n),X.debug("request id "+n.id+" should now be removed")),200===r){var s=this._requests[0]===n;(this._requests[1]===n||s&&this._requests.length>0&&this._requests[0].age()>Math.floor(X.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),X.debug("request id "+n.id+"."+n.sends+" got 200"),t(n),this.errors=0}else 0===r||r>=400&&r<600||r>=12e3?(X.error("request id "+n.id+"."+n.sends+" error "+r+" happened"),this._hitError(r),this._callProtocolErrorHandlers(n),r>=400&&r<500&&(this._conn._changeConnectStatus(X.Status.DISCONNECTING,null),this._conn._doDisconnect())):X.error("request id "+n.id+"."+n.sends+" error "+r+" happened");i||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(X.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}}},{key:"_processRequest",value:function(t){var n=this,r=this._requests[t],i=e._getRequestStatus(r,-1);if(r.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var o=r.age(),s=!isNaN(o)&&o>Math.floor(X.TIMEOUT*this.wait),a=null!==r.dead&&r.timeDead()>Math.floor(X.SECONDARY_TIMEOUT*this.wait),c=4===r.xhr.readyState&&(i<1||i>=500);if((s||a||c)&&(a&&X.error("Request ".concat(this._requests[t].id," timed out (secondary), restarting")),r.abort=!0,r.xhr.abort(),r.xhr.onreadystatechange=function(){},this._requests[t]=new X.Request(r.xmlData,r.origFunc,r.rid,r.sends),r=this._requests[t]),0===r.xhr.readyState){X.debug("request id "+r.id+"."+r.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";r.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==r.xhr.setRequestHeader&&r.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(r.xhr.withCredentials=!0)}catch(e){return X.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(X.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var l=function(){if(r.date=new Date,n._conn.options.customHeaders){var e=n._conn.options.customHeaders;for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.xhr.setRequestHeader(t,e[t])}r.xhr.send(r.data)};if(r.sends>1){var h=1e3*Math.min(Math.floor(X.TIMEOUT*this.wait),Math.pow(r.sends,3));setTimeout(function(){l()},h)}else l();r.sends++,this._conn.xmlOutput!==X.Connection.prototype.xmlOutput&&(r.xmlData.nodeName===this.strip&&r.xmlData.childNodes.length?this._conn.xmlOutput(r.xmlData.childNodes[0]):this._conn.xmlOutput(r.xmlData)),this._conn.rawOutput!==X.Connection.prototype.rawOutput&&this._conn.rawOutput(r.data)}else X.debug("_processRequest: "+(0===t?"first":"second")+" request has readyState of "+r.xhr.readyState)}}},{key:"_removeRequest",value:function(e){X.debug("removing request");for(var t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()}},{key:"_restartRequest",value:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)}},{key:"_reqToData",value:function(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}}},{key:"_sendTerminate",value:function(e){X.debug("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new X.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()}},{key:"_send",value:function(){var e=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){return e._conn._onIdle()},100)}},{key:"_sendRestart",value:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)}},{key:"_throttledRequestHandler",value:function(){this._requests?X.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):X.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}],[{key:"_getRequestStatus",value:function(e,t){var n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){X.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n}}]),e}(),X.Bosh.prototype.strip=null,X.Websocket=function(){function e(t){o(this,e),this._conn=t,this.strip="wrapper";var n=t.service;if(0!==n.indexOf("ws:")&&0!==n.indexOf("wss:")){var r="";"ws"===t.options.protocol&&"https:"!==window.location.protocol?r+="ws":r+="wss",r+="://"+window.location.host,0!==n.indexOf("/")?r+=window.location.pathname+n:r+=n,t.service=r}}return a(e,[{key:"_buildStream",value:function(){return B("open",{xmlns:X.NS.FRAMING,to:this._conn.domain,version:"1.0"})}},{key:"_checkStreamError",value:function(e,t){var n;if(0===(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(X.NS.STREAM,"error"):e.getElementsByTagName("stream:error")).length)return!1;for(var r=n[0],i="",o="",s=0;s<r.childNodes.length;s++){var a=r.childNodes[s];if("urn:ietf:params:xml:ns:xmpp-streams"!==a.getAttribute("xmlns"))break;"text"===a.nodeName?o=a.textContent:i=a.nodeName}var c="WebSocket stream error: ";return c+=i||"unknown",o&&(c+=" - "+o),X.error(c),this._conn._changeConnectStatus(t,i),this._conn._doDisconnect(),!0}},{key:"_reset",value:function(){}},{key:"_connect",value:function(){var e=this;this._closeSocket(),this.socket=new p(this._conn.service,"xmpp"),this.socket.onopen=function(){return e._onOpen()},this.socket.onerror=function(t){return e._onError(t)},this.socket.onclose=function(t){return e._onClose(t)},this.socket.onmessage=function(t){return e._onInitialMessage(t)}}},{key:"_connect_cb",value:function(e){if(this._checkStreamError(e,X.Status.CONNFAIL))return X.Status.CONNFAIL}},{key:"_handleStreamStart",value:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==X.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);var r=e.getAttribute("version");return"string"!=typeof r?t="Missing version in <open />":"1.0"!==r&&(t="Wrong version in <open />: "+r),!t||(this._conn._changeConnectStatus(X.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)}},{key:"_onInitialMessage",value:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;var n=(new _).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){var r=(new _).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(r),this._conn.rawInput(e.data);var i=r.getAttribute("see-other-uri");if(i){var o=this._conn.service;(o.indexOf("wss:")>=0&&i.indexOf("wss:")>=0||o.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(X.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=i,this._connect())}else this._conn._changeConnectStatus(X.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{this._replaceMessageHandler();var s=this._streamWrap(e.data),a=(new _).parseFromString(s,"text/xml").documentElement;this._conn._connect_cb(a,null,e.data)}}},{key:"_replaceMessageHandler",value:function(){var e=this;this.socket.onmessage=function(t){return e._onMessage(t)}}},{key:"_disconnect",value:function(e){var t=this;if(this.socket&&this.socket.readyState!==p.CLOSED){e&&this._conn.send(e);var n=B("close",{xmlns:X.NS.FRAMING});this._conn.xmlOutput(n.tree());var r=X.serialize(n);this._conn.rawOutput(r);try{this.socket.send(r)}catch(e){X.warn("Couldn't send <close /> tag.")}}setTimeout(function(){return t._conn._doDisconnect},0)}},{key:"_doDisconnect",value:function(){X.debug("WebSockets _doDisconnect was called"),this._closeSocket()}},{key:"_streamWrap",value:function(e){return"<wrapper>"+e+"</wrapper>"}},{key:"_closeSocket",value:function(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){X.debug(e.message)}this.socket=null}},{key:"_emptyQueue",value:function(){return!0}},{key:"_onClose",value:function(e){this._conn.connected&&!this._conn.disconnecting?(X.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(X.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(X.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):X.debug("Websocket closed")}},{key:"_no_auth_received",value:function(e){X.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(X.Status.CONNFAIL,X.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()}},{key:"_onDisconnectTimeout",value:function(){}},{key:"_abortAllRequests",value:function(){}},{key:"_onError",value:function(e){X.error("Websocket error "+e),this._conn._changeConnectStatus(X.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()}},{key:"_onIdle",value:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n=void 0;n="restart"===e[t]?this._buildStream().tree():e[t];var r=X.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}}},{key:"_onMessage",value:function(e){var t,n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new _).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{var r=this._streamWrap(e.data);t=(new _).parseFromString(r,"text/xml").documentElement}return this._checkStreamError(t,X.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(X.serialize(t))):void this._conn._dataRecv(t,e.data)}},{key:"_onOpen",value:function(){X.debug("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=X.serialize(e);this._conn.rawOutput(t),this.socket.send(t)}},{key:"_reqToData",value:function(e){return e}},{key:"_send",value:function(){this._conn.flush()}},{key:"_sendRestart",value:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}]),e}();var W={};W.debug=X.LogLevel.DEBUG,W.info=X.LogLevel.INFO,W.warn=X.LogLevel.WARN,W.error=X.LogLevel.ERROR,W.fatal=X.LogLevel.FATAL,X.WorkerWebsocket=function(e){c(n,X.Websocket);var t=d(n);function n(e){var r;return o(this,n),(r=t.call(this,e))._conn=e,r.worker=new SharedWorker(r._conn.options.worker,"Strophe XMPP Connection"),r.worker.onerror=function(e){var t;null===(t=console)||void 0===t||t.error(e),X.log(X.LogLevel.ERROR,"Shared Worker Error: ".concat(e))},r}return a(n,[{key:"_connect",value:function(){var e=this;this._messageHandler=function(t){return e._onInitialMessage(t)},this.worker.port.start(),this.worker.port.onmessage=function(t){return e._onWorkerMessage(t)},this.worker.port.postMessage(["_connect",this._conn.service,this._conn.jid])}},{key:"_attach",value:function(e){var t=this;this._messageHandler=function(e){return t._onMessage(e)},this._conn.connect_callback=e,this.worker.port.start(),this.worker.port.onmessage=function(e){return t._onWorkerMessage(e)},this.worker.port.postMessage(["_attach",this._conn.service])}},{key:"_attachCallback",value:function(e,t){e===X.Status.ATTACHED?(this._conn.jid=t,this._conn.authenticated=!0,this._conn.connected=!0,this._conn.restored=!0,this._conn._changeConnectStatus(X.Status.ATTACHED)):e===X.Status.ATTACHFAIL&&(this._conn.authenticated=!1,this._conn.connected=!1,this._conn.restored=!1,this._conn._changeConnectStatus(X.Status.ATTACHFAIL))}},{key:"_disconnect",value:function(e,t){t&&this._conn.send(t);var n=B("close",{xmlns:X.NS.FRAMING});this._conn.xmlOutput(n.tree());var r=X.serialize(n);this._conn.rawOutput(r),this.worker.port.postMessage(["send",r]),this._conn._doDisconnect()}},{key:"_onClose",value:function(e){this._conn.connected&&!this._conn.disconnecting?(X.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected?(X.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(X.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):X.debug("Websocket closed")}},{key:"_closeSocket",value:function(){this.worker.port.postMessage(["_closeSocket"])}},{key:"_replaceMessageHandler",value:function(){var e=this;this._messageHandler=function(t){return e._onMessage(t)}}},{key:"_onWorkerMessage",value:function(e){var t=e.data,n=t[0];if("_onMessage"===n)this._messageHandler(t[1]);else if(n in this)try{this[n].apply(this,e.data.slice(1))}catch(e){X.log(X.LogLevel.ERROR,e)}else if("log"===n){var r=t[1],i=t[2];X.log(W[r],i)}else X.log(X.LogLevel.ERROR,"Found unhandled service worker message: ".concat(t))}},{key:"socket",get:function(){var e=this;return{send:function(t){return e.worker.port.postMessage(["send",t])}}}}]),n}(),r.$build=$.$build,r.$iq=$.$iq,r.$msg=$.$msg,r.$pres=$.$pres,r.Strophe=$.Strophe;var J=H.b64_sha1;t.$build=B,t.$iq=U,t.$msg=j,t.$pres=P,t.Strophe=X,t.b64_sha1=J,Object.defineProperty(t,"__esModule",{value:!0})})(t)}).call(t,n(4))},109:function(e,t,n){"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},110:function(e,t){var n=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,r=new RegExp("[\\-\\.0-9"+n.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),i=new RegExp("^"+n.source+r.source+"*(?::"+n.source+r.source+"*)?$"),o=0,s=1,a=2,c=3,u=4,l=5,h=6,d=7;function f(){}function m(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function p(e,t,n,r,i,f){for(var m,p=++t,_=o;;){var g=e.charAt(p);switch(g){case"=":if(_===s)m=e.slice(t,p),_=c;else{if(_!==a)throw new Error("attribute equal must after attrName");_=c}break;case"'":case'"':if(_===c||_===s){if(_===s&&(f.warning('attribute value must after "="'),m=e.slice(t,p)),t=p+1,!((p=e.indexOf(g,t))>0))throw new Error("attribute value no end '"+g+"' match");v=e.slice(t,p).replace(/&#?\w+;/g,i),n.add(m,v,t-1),_=l}else{if(_!=u)throw new Error('attribute value must after "="');v=e.slice(t,p).replace(/&#?\w+;/g,i),n.add(m,v,t),f.warning('attribute "'+m+'" missed start quot('+g+")!!"),t=p+1,_=l}break;case"/":switch(_){case o:n.setTagName(e.slice(t,p));case l:case h:case d:_=d,n.closed=!0;case u:case s:case a:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return f.error("unexpected end of input"),_==o&&n.setTagName(e.slice(t,p)),p;case">":switch(_){case o:n.setTagName(e.slice(t,p));case l:case h:case d:break;case u:case s:"/"===(v=e.slice(t,p)).slice(-1)&&(n.closed=!0,v=v.slice(0,-1));case a:_===a&&(v=m),_==u?(f.warning('attribute "'+v+'" missed quot(")!!'),n.add(m,v.replace(/&#?\w+;/g,i),t)):("http://www.w3.org/1999/xhtml"===r[""]&&v.match(/^(?:disabled|checked|selected)$/i)||f.warning('attribute "'+v+'" missed value!! "'+v+'" instead!!'),n.add(v,v,t));break;case c:throw new Error("attribute value missed!!")}return p;case"":g=" ";default:if(g<=" ")switch(_){case o:n.setTagName(e.slice(t,p)),_=h;break;case s:m=e.slice(t,p),_=a;break;case u:var v=e.slice(t,p).replace(/&#?\w+;/g,i);f.warning('attribute "'+v+'" missed quot(")!!'),n.add(m,v,t);case l:_=h}else switch(_){case a:n.tagName;"http://www.w3.org/1999/xhtml"===r[""]&&m.match(/^(?:disabled|checked|selected)$/i)||f.warning('attribute "'+m+'" missed value!! "'+m+'" instead2!!'),n.add(m,m,t),t=p,_=s;break;case l:f.warning('attribute space is required"'+m+'"!!');case h:_=s,t=p;break;case c:_=u,t=p;break;case d:throw new Error("elements closed character '/' and '>' must be connected to")}}p++}}function _(e,t,n){for(var r=e.tagName,i=null,o=e.length;o--;){var s=e[o],a=s.qName,c=s.value;if((d=a.indexOf(":"))>0)var u=s.prefix=a.slice(0,d),l=a.slice(d+1),h="xmlns"===u&&l;else l=a,u=null,h="xmlns"===a&&"";s.localName=l,!1!==h&&(null==i&&(i={},y(n,n={})),n[h]=i[h]=c,s.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(h,c))}for(o=e.length;o--;){(u=(s=e[o]).prefix)&&("xml"===u&&(s.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==u&&(s.uri=n[u||""]))}var d;(d=r.indexOf(":"))>0?(u=e.prefix=r.slice(0,d),l=e.localName=r.slice(d+1)):(u=null,l=e.localName=r);var f=e.uri=n[u||""];if(t.startElement(f,l,r,e),!e.closed)return e.currentNSMap=n,e.localNSMap=i,!0;if(t.endElement(f,l,r),i)for(u in i)t.endPrefixMapping(u)}function g(e,t,n,r,i){if(/^(?:script|textarea)$/i.test(n)){var o=e.indexOf("</"+n+">",t),s=e.substring(t+1,o);if(/[&<]/.test(s))return/^script$/i.test(n)?(i.characters(s,0,s.length),o):(s=s.replace(/&#?\w+;/g,r),i.characters(s,0,s.length),o)}return t+1}function v(e,t,n,r){var i=r[n];return null==i&&((i=e.lastIndexOf("</"+n+">"))<t&&(i=e.lastIndexOf("</"+n)),r[n]=i),i<t}function y(e,t){for(var n in e)t[n]=e[n]}function b(e,t,n,r){switch(e.charAt(t+2)){case"-":return"-"===e.charAt(t+3)?(i=e.indexOf("--\x3e",t+4))>t?(n.comment(e,t+4,i-t-4),i+3):(r.error("Unclosed comment"),-1):-1;default:if("CDATA["==e.substr(t+3,6)){var i=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,i-t-9),n.endCDATA(),i+3}var o=function(e,t){var n,r=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;i.lastIndex=t,i.exec(e);for(;n=i.exec(e);)if(r.push(n),n[1])return r}(e,t),s=o.length;if(s>1&&/!doctype/i.test(o[0][0])){var a=o[1][0],c=s>3&&/^public$/i.test(o[2][0])&&o[3][0],u=s>4&&o[4][0],l=o[s-1];return n.startDTD(a,c&&c.replace(/^(['"])(.*?)\1$/,"$2"),u&&u.replace(/^(['"])(.*?)\1$/,"$2")),n.endDTD(),l.index+l[0].length}}return-1}function N(e,t,n){var r=e.indexOf("?>",t);if(r){var i=e.substring(t,r).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(i){i[0].length;return n.processingInstruction(i[1],i[2]),r+2}return-1}return-1}function S(e){}function w(e,t){return e.__proto__=t,e}f.prototype={parse:function(e,t,n){var r=this.domBuilder;r.startDocument(),y(t,t={}),function(e,t,n,r,i){function o(e){var t=e.slice(1,-1);return t in n?n[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(i.error("entity not found:"+e),e)}function s(t){if(t>y){var n=e.substring(y,t).replace(/&#?\w+;/g,o);h&&a(y),r.characters(n,0,t-y),y=t}}function a(t,n){for(;t>=u&&(n=l.exec(e));)c=n.index,u=c+n[0].length,h.lineNumber++;h.columnNumber=t-c+1}var c=0,u=0,l=/.*(?:\r\n?|\n)|.*$/g,h=r.locator,d=[{currentNSMap:t}],f={},y=0;for(;;){try{var w=e.indexOf("<",y);if(w<0){if(!e.substr(y).match(/^\s*$/)){var T=r.doc,x=T.createTextNode(e.substr(y));T.appendChild(x),r.currentElement=x}return}switch(w>y&&s(w),e.charAt(w+1)){case"/":var C=e.indexOf(">",w+3),E=e.substring(w+2,C),A=d.pop();C<0?(E=e.substring(w+2).replace(/[\s<].*/,""),i.error("end tag name: "+E+" is not complete:"+A.tagName),C=w+1+E.length):E.match(/\s</)&&(E=E.replace(/[\s<].*/,""),i.error("end tag name: "+E+" maybe not complete"),C=w+1+E.length);var k=A.localNSMap,D=A.tagName==E,I=D||A.tagName&&A.tagName.toLowerCase()==E.toLowerCase();if(I){if(r.endElement(A.uri,A.localName,E),k)for(var O in k)r.endPrefixMapping(O);D||i.fatalError("end tag name: "+E+" is not match the current start tagName:"+A.tagName)}else d.push(A);C++;break;case"?":h&&a(w),C=N(e,w,r);break;case"!":h&&a(w),C=b(e,w,r,i);break;default:h&&a(w);var R=new S,M=d[d.length-1].currentNSMap,C=p(e,w,R,M,o,i),L=R.length;if(!R.closed&&v(e,C,R.tagName,f)&&(R.closed=!0,n.nbsp||i.warning("unclosed xml attribute")),h&&L){for(var H=m(h,{}),q=0;q<L;q++){var F=R[q];a(F.offset),F.locator=m(h,{})}r.locator=H,_(R,r,M)&&d.push(R),r.locator=h}else _(R,r,M)&&d.push(R);"http://www.w3.org/1999/xhtml"!==R.uri||R.closed?C++:C=g(e,C,R.tagName,o,r)}}catch(e){i.error("element parse error: "+e),C=-1}C>y?y=C:s(Math.max(w,y)+1)}}(e,t,n,r,this.errorHandler),r.endDocument()}},S.prototype={setTagName:function(e){if(!i.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,n){if(!i.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},w({},w.prototype)instanceof w||(w=function(e,t){function n(){}for(t in n.prototype=t,n=new n,e)n[t]=e[t];return n}),t.XMLReader=f},4:function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},53:function(e,t,n){function r(e){this.options=e||{locator:{}}}function i(){this.cdata=!1}function o(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function s(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function a(e,t,n){return"string"==typeof e?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}function c(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}r.prototype.parseFromString=function(e,t){var n=this.options,r=new u,o=n.domBuilder||new i,a=n.errorHandler,c=n.locator,l=n.xmlns||{},h={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return c&&o.setDocumentLocator(c),r.errorHandler=function(e,t,n){if(!e){if(t instanceof i)return t;e=t}var r={},o=e instanceof Function;function a(t){var i=e[t];!i&&o&&(i=2==e.length?function(n){e(t,n)}:e),r[t]=i&&function(e){i("[xmldom "+t+"]\t"+e+s(n))}||function(){}}return n=n||{},a("warning"),a("error"),a("fatalError"),r}(a,o,c),r.domBuilder=n.domBuilder||o,/\/x?html?$/.test(t)&&(h.nbsp=" ",h.copy="©",l[""]="http://www.w3.org/1999/xhtml"),l.xml=l.xml||"http://www.w3.org/XML/1998/namespace",e?r.parse(e,l,h):r.errorHandler.error("invalid doc source"),o.doc},i.prototype={startDocument:function(){this.doc=(new l).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,n,r){var i=this.doc,s=i.createElementNS(e,n||t),a=r.length;c(this,s),this.currentElement=s,this.locator&&o(this.locator,s);for(var u=0;u<a;u++){e=r.getURI(u);var l=r.getValue(u),h=(n=r.getQName(u),i.createAttributeNS(e,n));this.locator&&o(r.getLocator(u),h),h.value=h.nodeValue=l,s.setAttributeNode(h)}},endElement:function(e,t,n){var r=this.currentElement;r.tagName;this.currentElement=r.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.doc.createProcessingInstruction(e,t);this.locator&&o(this.locator,n),c(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=a.apply(this,arguments)){if(this.cdata)var r=this.doc.createCDATASection(e);else r=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(r):/^\s*$/.test(e)&&this.doc.appendChild(r),this.locator&&o(this.locator,r)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=a.apply(this,arguments);var r=this.doc.createComment(e);this.locator&&o(this.locator,r),c(this,r)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var r=this.doc.implementation;if(r&&r.createDocumentType){var i=r.createDocumentType(e,t,n);this.locator&&o(this.locator,i),c(this,i)}},warning:function(e){console.warn("[xmldom warning]\t"+e,s(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,s(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,s(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){i.prototype[e]=function(){return null}});var u=n(110).XMLReader,l=t.DOMImplementation=n(54).DOMImplementation;t.XMLSerializer=n(54).XMLSerializer,t.DOMParser=r},54:function(e,t){function n(e,t){for(var n in e)t[n]=e[n]}function r(e,t){var r=e.prototype;if(Object.create){var i=Object.create(t.prototype);r.__proto__=i}if(!(r instanceof t)){function o(){}o.prototype=t.prototype,n(r,o=new o),e.prototype=r=o}r.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),r.constructor=e)}var i="http://www.w3.org/1999/xhtml",o={},s=o.ELEMENT_NODE=1,a=o.ATTRIBUTE_NODE=2,c=o.TEXT_NODE=3,u=o.CDATA_SECTION_NODE=4,l=o.ENTITY_REFERENCE_NODE=5,h=o.ENTITY_NODE=6,d=o.PROCESSING_INSTRUCTION_NODE=7,f=o.COMMENT_NODE=8,m=o.DOCUMENT_NODE=9,p=o.DOCUMENT_TYPE_NODE=10,_=o.DOCUMENT_FRAGMENT_NODE=11,g=o.NOTATION_NODE=12,v={},y={},b=(v.INDEX_SIZE_ERR=(y[1]="Index size error",1),v.DOMSTRING_SIZE_ERR=(y[2]="DOMString size error",2),v.HIERARCHY_REQUEST_ERR=(y[3]="Hierarchy request error",3)),N=(v.WRONG_DOCUMENT_ERR=(y[4]="Wrong document",4),v.INVALID_CHARACTER_ERR=(y[5]="Invalid character",5),v.NO_DATA_ALLOWED_ERR=(y[6]="No data allowed",6),v.NO_MODIFICATION_ALLOWED_ERR=(y[7]="No modification allowed",7),v.NOT_FOUND_ERR=(y[8]="Not found",8)),S=(v.NOT_SUPPORTED_ERR=(y[9]="Not supported",9),v.INUSE_ATTRIBUTE_ERR=(y[10]="Attribute in use",10));v.INVALID_STATE_ERR=(y[11]="Invalid state",11),v.SYNTAX_ERR=(y[12]="Syntax error",12),v.INVALID_MODIFICATION_ERR=(y[13]="Invalid modification",13),v.NAMESPACE_ERR=(y[14]="Invalid namespace",14),v.INVALID_ACCESS_ERR=(y[15]="Invalid access",15);function w(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,y[e]),this.message=y[e],Error.captureStackTrace&&Error.captureStackTrace(this,w);return n.code=e,t&&(this.message=this.message+": "+t),n}function T(){}function x(e,t){this._node=e,this._refresh=t,C(this)}function C(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var r=e._refresh(e._node);ne(e,"length",r.length),n(r,e),e._inc=t}}function E(){}function A(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function k(e,t,n,r){if(r?t[A(t,r)]=n:t[t.length++]=n,e){n.ownerElement=e;var i=e.ownerDocument;i&&(r&&H(i,e,r),function(e,t,n){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&(t._nsMap[n.prefix?n.localName:""]=n.value)}(i,e,n))}}function D(e,t,n){var r=A(t,n);if(!(r>=0))throw w(N,new Error(e.tagName+"@"+n));for(var i=t.length-1;r<i;)t[r]=t[++r];if(t.length=i,e){var o=e.ownerDocument;o&&(H(o,e,n),n.ownerElement=null)}}function I(e){if(this._features={},e)for(var t in e)this._features=e[t]}function O(){}function R(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function M(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(M(e,t))return!0}while(e=e.nextSibling)}function L(){}function H(e,t,n,r){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&delete t._nsMap[n.prefix?n.localName:""]}function q(e,t,n){if(e&&e._inc){e._inc++;var r=t.childNodes;if(n)r[r.length++]=n;else{for(var i=t.firstChild,o=0;i;)r[o++]=i,i=i.nextSibling;r.length=o}}}function F(e,t){var n=t.previousSibling,r=t.nextSibling;return n?n.nextSibling=r:e.firstChild=r,r?r.previousSibling=n:e.lastChild=n,q(e.ownerDocument,e),t}function B(e,t,n){var r=t.parentNode;if(r&&r.removeChild(t),t.nodeType===_){var i=t.firstChild;if(null==i)return t;var o=t.lastChild}else i=o=t;var s=n?n.previousSibling:e.lastChild;i.previousSibling=s,o.nextSibling=n,s?s.nextSibling=i:e.firstChild=i,null==n?e.lastChild=o:n.previousSibling=o;do{i.parentNode=e}while(i!==o&&(i=i.nextSibling));return q(e.ownerDocument||e,e),t.nodeType==_&&(t.firstChild=t.lastChild=null),t}function j(){this._nsMap={}}function U(){}function P(){}function X(){}function $(){}function W(){}function J(){}function G(){}function z(){}function V(){}function Q(){}function Y(){}function Z(){}function K(e,t){var n=[],r=9==this.nodeType?this.documentElement:this,i=r.prefix,o=r.namespaceURI;if(o&&null==i&&null==(i=r.lookupPrefix(o)))var s=[{namespace:o,prefix:null}];return te(this,n,e,t,s),n.join("")}function ee(e,t,n){var r=e.prefix||"",i=e.namespaceURI;if(!r&&!i)return!1;if("xml"===r&&"http://www.w3.org/XML/1998/namespace"===i||"http://www.w3.org/2000/xmlns/"==i)return!1;for(var o=n.length;o--;){var s=n[o];if(s.prefix==r)return s.namespace!=i}return!0}function te(e,t,n,r,o){if(r){if(!(e=r(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case s:o||(o=[]);o.length;var h=e.attributes,g=h.length,v=e.firstChild,y=e.tagName;n=i===e.namespaceURI||n,t.push("<",y);for(var b=0;b<g;b++){"xmlns"==(N=h.item(b)).prefix?o.push({prefix:N.localName,namespace:N.value}):"xmlns"==N.nodeName&&o.push({prefix:"",namespace:N.value})}for(b=0;b<g;b++){var N;if(ee(N=h.item(b),0,o)){var S=N.prefix||"",w=N.namespaceURI,T=S?" xmlns:"+S:" xmlns";t.push(T,'="',w,'"'),o.push({prefix:S,namespace:w})}te(N,t,n,r,o)}if(ee(e,0,o)){S=e.prefix||"",w=e.namespaceURI,T=S?" xmlns:"+S:" xmlns";t.push(T,'="',w,'"'),o.push({prefix:S,namespace:w})}if(v||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(y)){if(t.push(">"),n&&/^script$/i.test(y))for(;v;)v.data?t.push(v.data):te(v,t,n,r,o),v=v.nextSibling;else for(;v;)te(v,t,n,r,o),v=v.nextSibling;t.push("</",y,">")}else t.push("/>");return;case m:case _:for(v=e.firstChild;v;)te(v,t,n,r,o),v=v.nextSibling;return;case a:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,R),'"');case c:return t.push(e.data.replace(/[<&]/g,R));case u:return t.push("<![CDATA[",e.data,"]]>");case f:return t.push("\x3c!--",e.data,"--\x3e");case p:var x=e.publicId,C=e.systemId;if(t.push("<!DOCTYPE ",e.name),x)t.push(' PUBLIC "',x),C&&"."!=C&&t.push('" "',C),t.push('">');else if(C&&"."!=C)t.push(' SYSTEM "',C,'">');else{var E=e.internalSubset;E&&t.push(" [",E,"]"),t.push(">")}return;case d:return t.push("<?",e.target," ",e.data,"?>");case l:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function ne(e,t,n){e[t]=n}w.prototype=Error.prototype,n(v,w),T.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var n=[],r=0;r<this.length;r++)te(this[r],n,e,t);return n.join("")}},x.prototype.item=function(e){return C(this),this[e]},r(x,T),E.prototype={length:0,item:T.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new w(S);var n=this.getNamedItem(e.nodeName);return k(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new w(S);return t=this.getNamedItemNS(e.namespaceURI,e.localName),k(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return D(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return D(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var r=this[n];if(r.localName==t&&r.namespaceURI==e)return r}return null}},I.prototype={hasFeature:function(e,t){var n=this._features[e.toLowerCase()];return!(!n||t&&!(t in n))},createDocument:function(e,t,n){var r=new L;if(r.implementation=this,r.childNodes=new T,r.doctype=n,n&&r.appendChild(n),t){var i=r.createElementNS(e,t);r.appendChild(i)}return r},createDocumentType:function(e,t,n){var r=new J;return r.name=e,r.nodeName=e,r.publicId=t,r.systemId=n,r}},O.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return B(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return F(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return function e(t,n,r){var i=new n.constructor;for(var o in n){var c=n[o];"object"!=typeof c&&c!=i[o]&&(i[o]=c)}n.childNodes&&(i.childNodes=new T);i.ownerDocument=t;switch(i.nodeType){case s:var u=n.attributes,l=i.attributes=new E,h=u.length;l._ownerElement=i;for(var d=0;d<h;d++)i.setAttributeNode(e(t,u.item(d),!0));break;case a:r=!0}if(r)for(var f=n.firstChild;f;)i.appendChild(e(t,f,r)),f=f.nextSibling;return i}(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==c&&e.nodeType==c?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var r in n)if(n[r]==e)return r;t=t.nodeType==a?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&e in n)return n[e];t=t.nodeType==a?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},n(o,O),n(o,O.prototype),L.prototype={nodeName:"#document",nodeType:m,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==_){for(var n=e.firstChild;n;){var r=n.nextSibling;this.insertBefore(n,t),n=r}return e}return null==this.documentElement&&e.nodeType==s&&(this.documentElement=e),B(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),F(this,e)},importNode:function(e,t){return function e(t,n,r){var i;switch(n.nodeType){case s:(i=n.cloneNode(!1)).ownerDocument=t;case _:break;case a:r=!0}i||(i=n.cloneNode(!1));i.ownerDocument=t;i.parentNode=null;if(r)for(var o=n.firstChild;o;)i.appendChild(e(t,o,r)),o=o.nextSibling;return i}(this,e,t)},getElementById:function(e){var t=null;return M(this.documentElement,function(n){if(n.nodeType==s&&n.getAttribute("id")==e)return t=n,!0}),t},createElement:function(e){var t=new j;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new T,(t.attributes=new E)._ownerElement=t,t},createDocumentFragment:function(){var e=new Q;return e.ownerDocument=this,e.childNodes=new T,e},createTextNode:function(e){var t=new X;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new $;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new W;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new Y;return n.ownerDocument=this,n.tagName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new U;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new V;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new j,r=t.split(":"),i=n.attributes=new E;return n.childNodes=new T,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,i._ownerElement=n,n},createAttributeNS:function(e,t){var n=new U,r=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,n}},r(L,O),j.prototype={nodeType:s,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===_?this.insertBefore(e,null):function(e,t){var n=t.parentNode;if(n){var r=e.lastChild;n.removeChild(t),r=e.lastChild}return r=e.lastChild,t.parentNode=e,t.previousSibling=r,t.nextSibling=null,r?r.nextSibling=t:e.firstChild=t,e.lastChild=t,q(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var r=this.ownerDocument.createAttributeNS(e,t);r.value=r.nodeValue=""+n,this.setAttributeNode(r)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new x(this,function(t){var n=[];return M(t,function(r){r===t||r.nodeType!=s||"*"!==e&&r.tagName!=e||n.push(r)}),n})},getElementsByTagNameNS:function(e,t){return new x(this,function(n){var r=[];return M(n,function(i){i===n||i.nodeType!==s||"*"!==e&&i.namespaceURI!==e||"*"!==t&&i.localName!=t||r.push(i)}),r})}},L.prototype.getElementsByTagName=j.prototype.getElementsByTagName,L.prototype.getElementsByTagNameNS=j.prototype.getElementsByTagNameNS,r(j,O),U.prototype.nodeType=a,r(U,O),P.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(y[b])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){n=this.data.substring(0,e)+n+this.data.substring(e+t),this.nodeValue=this.data=n,this.length=n.length}},r(P,O),X.prototype={nodeName:"#text",nodeType:c,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var r=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling),r}},r(X,P),$.prototype={nodeName:"#comment",nodeType:f},r($,P),W.prototype={nodeName:"#cdata-section",nodeType:u},r(W,P),J.prototype.nodeType=p,r(J,O),G.prototype.nodeType=g,r(G,O),z.prototype.nodeType=h,r(z,O),V.prototype.nodeType=l,r(V,O),Q.prototype.nodeName="#document-fragment",Q.prototype.nodeType=_,r(Q,O),Y.prototype.nodeType=d,r(Y,O),Z.prototype.serializeToString=function(e,t,n){return K.call(e,t,n)},O.prototype.toString=K;try{if(Object.defineProperty){Object.defineProperty(x.prototype,"length",{get:function(){return C(this),this.$$length}}),Object.defineProperty(O.prototype,"textContent",{get:function(){return function e(t){switch(t.nodeType){case s:case _:var n=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&n.push(e(t)),t=t.nextSibling;return n.join("");default:return t.nodeValue}}(this)},set:function(e){switch(this.nodeType){case s:case _:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),ne=function(e,t,n){e["$$"+t]=n}}}catch(e){}t.DOMImplementation=I,t.XMLSerializer=Z}});